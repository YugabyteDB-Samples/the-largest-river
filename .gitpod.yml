# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.

image:
  file: .gitpod.Dockerfile

ports:
  - port: 3000
    onOpen: open-preview
  - port: 8000
    visibility: public

tasks:
  - name: YugabyteDB Shell
    command: |
      gp ports await 5433
      ysqlsh
    openMode: split-right
  - name: Server Start
    init: cd products_service && npm install && cd ..
    command: |
      gp ports await 5433
      DATABASE_NAME=yugabyte NODE_CONFIG_DIR=products_service/config NODE_ENV=gitpod node products_service/seed.js
      DATABASE_NAME=yugabyte NODE_CONFIG_DIR=products_service/config NODE_ENV=gitpod NODE_APP_INSTANCE=los-angeles node products_service/index.js
    openMode: split-right
  - name: Client Start
    init: cd tlr-ui && npm install
    command: |
      export REACT_APP_GITPOD_SERVER_URL=$(gp url 8000)
      echo "This is the Gitpod server url:"
      echo $REACT_APP_GITPOD_SERVER_URL
      REACT_APP_GITPOD_SERVER_URL=$REACT_APP_GITPOD_SERVER_URL DANGEROUSLY_DISABLE_HOST_CHECK=true REACT_APP_ENV_IS_GITPOD=true npm run start